<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paycheck Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            /* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
            background:white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            padding: 32px;
            color: white;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            padding: 32px;
        }

        .input-section {
            background: #f8fafc;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .output-section {
            background: #fefefe;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #4f46e5;
            border-radius: 2px;
            margin-right: 12px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .required {
            color: #dc2626;
            margin-left: 4px;
        }

        .tooltip {
            margin-left: 8px;
            cursor: help;
            color: #6b7280;
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            max-width: 200px;
            white-space: normal;
            width: max-content;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .input-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        input,
        select {
            flex: 1;
            padding: 7px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            background: white;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .toggle-btn {
            padding: 8px 12px;
            background: #e5e7eb;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            min-width: 40px;
        }

        .toggle-btn.active {
            background: #4f46e5;
            color: white;
        }

        .external-link {
            color: #4f46e5;
            text-decoration: underline;
            cursor: pointer;
            font-size: 12px;
            margin-top: 4px;
        }

        .buttons {
            display: flex;
            gap: 16px;
            margin-top: 24px;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn-reset {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-reset:hover {
            background: #e5e7eb;
        }

        .btn-download {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }

        .btn-download:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }

        .btn-download:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 24px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .results-table th,
        .results-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        .results-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
        }

        .results-table tr:hover {
            background: #f8fafc;
        }

        .final-pay {
            background: #ecfdf5 !important;
            font-weight: 600;
            color: #059669;
        }

        .table-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }


        .calculate-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .calculate-btn {
            padding: 12px 24px;
            font-size: 16px;
            background-color: #6366f1;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .calculate-btn:hover {
            background-color: #0056b3;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 24px;
                padding: 20px;
            }

            .header {
                padding: 24px 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .buttons {
                flex-direction: column;
            }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .refresh-icon {
            margin-left: 8px;
            cursor: pointer;
            color: #4f46e5;
        }

        .refresh-icon:hover {
            color: #3730a3;
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.6rem;
            }

            .header p {
                font-size: 0.95rem;
            }

            .section-title {
                font-size: 1.1rem;
            }

            .input-wrapper {
                flex-direction: column;
                align-items: stretch;
            }

            .input-wrapper input,
            .input-wrapper select {
                width: 100%;
                margin-bottom: 8px;
            }

            .toggle-btn {
                width: 100%;
            }

            .results-table th,
            .results-table td {
                font-size: 13px;
                padding: 10px 12px;
            }

            .buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
            }

            .table-title {
                font-size: 1rem;
                text-align: center;
            }

            .output-section {
                overflow-x: auto;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>💰 Paycheck Calculator</h1>
            <p>Calculate your take-home salary with taxes and deductions</p>
        </div>

        <div class="main-content">
            <!-- Input Section -->
            <div class="input-section">
                <h2 class="section-title">Input Details</h2>

                <div class="api-status">
                    <span class="status-dot"></span>
                    <span>Tax rates updated</span>
                    <span class="refresh-icon" onclick="loadTaxRates()">🔄</span>
                </div>

                <!-- Job Income -->
                <div class="input-group">
                    <label class="input-label">
                        Your Job Income <span class="required">*</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="jobIncome" placeholder="60000" required>
                        <select id="incomeType">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="bi-weekly">Bi-weekly</option>
                            <option value="semi-monthly">Semi-monthly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="semi-annually">Semi-annually</option>
                            <option value="annually" selected>Annually</option>
                        </select>
                    </div>
                </div>

                <!-- Pay Frequency -->
                <div class="input-group">
                    <label class="input-label">
                        Pay Frequency <span class="required">*</span>
                        <span class="tooltip"
                            data-tooltip="How often you receive your paycheck (e.g., weekly). Affects how income and deductions are broken down.">❓</span>
                    </label>
                    <select id="payFrequency" required>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="bi-weekly">Bi-weekly</option>
                        <option value="semi-monthly">Semi-monthly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="semi-annually">Semi-annually</option>
                        <option value="annually">Annually</option>
                    </select>
                </div>

                <!-- Federal Income Tax -->
                <div class="input-group">
                    <label class="input-label">
                        Federal Income Tax <span class="required">*</span>
                        <span class="tooltip"
                            data-tooltip="Mandatory tax by U.S. federal government. Ranges from 10%–37% (2025).">❓</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="federalTax" value="22" step="0.01" required>
                        <button type="button" class="toggle-btn active" onclick="toggleUnit('federal')">%</button>
                        <button type="button" class="toggle-btn" onclick="toggleUnit('federal')">$</button>
                    </div>
                </div>

                <!-- Social Security Tax -->
                <div class="input-group">
                    <label class="input-label">
                        Social Security Tax
                        <span class="tooltip"
                            data-tooltip="FICA contribution; 6.2% by employee. Funds Social Security.">❓</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="socialSecurityTax" value="6.2" step="0.01">
                        <button type="button" class="toggle-btn active"
                            onclick="toggleUnit('socialSecurity')">%</button>
                        <button type="button" class="toggle-btn" onclick="toggleUnit('socialSecurity')">$</button>
                    </div>
                </div>

                <!-- Medicare Tax -->
                <div class="input-group">
                    <label class="input-label">
                        Medicare Tax
                        <span class="tooltip"
                            data-tooltip="FICA contribution; 1.45% by employee. Plus 0.9% for higher incomes.">❓</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="medicareTax" value="1.45" step="0.01">
                        <button type="button" class="toggle-btn active" onclick="toggleUnit('medicare')">%</button>
                        <button type="button" class="toggle-btn" onclick="toggleUnit('medicare')">$</button>
                    </div>
                </div>

                <!-- State Income Tax -->
                <div class="input-group">
                    <label class="input-label">
                        State Income Tax
                        <span class="tooltip"
                            data-tooltip="Tax applied by U.S. states. Can be flat or progressive.">❓</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="stateTax" placeholder="0" step="0.01">
                        <button type="button" class="toggle-btn active" onclick="toggleUnit('state')">%</button>
                        <button type="button" class="toggle-btn" onclick="toggleUnit('state')">$</button>
                    </div>
                    <div class="external-link"
                        onclick="window.open('https://en.wikipedia.org/wiki/State_income_tax', '_blank')">
                        click here to check
                    </div>
                </div>

                <!-- City Income Tax -->
                <div class="input-group">
                    <label class="input-label">
                        City Income Tax
                        <span class="tooltip"
                            data-tooltip="Some cities add local income tax for services (schools, parks, etc.)">❓</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="cityTax" placeholder="0" step="0.01">
                        <button type="button" class="toggle-btn active" onclick="toggleUnit('city')">%</button>
                        <button type="button" class="toggle-btn" onclick="toggleUnit('city')">$</button>
                    </div>
                </div>

                <!-- Pre-Tax Deductions -->
                <div class="input-group">
                    <label class="input-label">
                        Pre-Tax Deductions
                        <span class="tooltip"
                            data-tooltip="401(k), insurance, etc. Deducted before taxes and reduces tax liability.">❓</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="preTaxDeductions" placeholder="0" step="0.01">
                        <button type="button" class="toggle-btn active" onclick="toggleUnit('preTax')">%</button>
                        <button type="button" class="toggle-btn" onclick="toggleUnit('preTax')">$</button>
                    </div>
                </div>

                <!-- Post-Tax Deductions -->
                <div class="input-group">
                    <label class="input-label">
                        Post-Tax Deductions
                        <span class="tooltip"
                            data-tooltip="E.g., union dues or loan payments. Deducted after taxes.">❓</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="postTaxDeductions" placeholder="0" step="0.01">
                        <button type="button" class="toggle-btn active" onclick="toggleUnit('postTax')">%</button>
                        <button type="button" class="toggle-btn" onclick="toggleUnit('postTax')">$</button>
                    </div>
                </div>

                <div class="calculate-wrapper">
                    <button class="btn calculate-btn" onclick="handleCalculate()">Calculate</button>
                </div>

                <div class="buttons">
                    <button class="btn btn-reset" onclick="resetAll()">Reset All</button>
                    <button class="btn btn-download" id="downloadBtn" onclick="downloadPDF()" disabled>
                        Download Paycheck Report
                    </button>
                </div>
            </div>

            <!-- Output Section -->
            <div id="results" class="output-section">
                <h2 class="section-title">Calculation Results</h2>

                <!-- Monthly Breakdown -->
                <div id="monthlyResults">
                    <div class="table-title">Monthly Paycheck Based on Income of $0/year</div>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Label</th>
                                <th>Amount ($)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Gross Pay</td>
                                <td id="monthly-gross">$0.00</td>
                            </tr>
                            <tr>
                                <td>Federal Income Tax</td>
                                <td id="monthly-federal">$0.00</td>
                            </tr>
                            <tr>
                                <td>Social Security Tax</td>
                                <td id="monthly-social">$0.00</td>
                            </tr>
                            <tr>
                                <td>Medicare Tax</td>
                                <td id="monthly-medicare">$0.00</td>
                            </tr>
                            <tr>
                                <td>State Income Tax</td>
                                <td id="monthly-state">$0.00</td>
                            </tr>
                            <tr>
                                <td>City Income Tax</td>
                                <td id="monthly-city">$0.00</td>
                            </tr>
                            <tr>
                                <td>Pre-Tax Deductions</td>
                                <td id="monthly-pretax">$0.00</td>
                            </tr>
                            <tr>
                                <td>Post-Tax Deductions</td>
                                <td id="monthly-posttax">$0.00</td>
                            </tr>
                            <tr class="final-pay">
                                <td><strong>Final Pay Check</strong></td>
                                <td id="monthly-final"><strong>$0.00</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Frequency-specific Results -->
                <div id="frequencyResults" style="display: none;">
                    <div class="table-title" id="frequencyTitle">Weekly Paycheck Based on Income of $0/year</div>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Label</th>
                                <th>Amount ($)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Gross Pay</td>
                                <td id="freq-gross">$0.00</td>
                            </tr>
                            <tr>
                                <td>Federal Income Tax</td>
                                <td id="freq-federal">$0.00</td>
                            </tr>
                            <tr>
                                <td>Social Security Tax</td>
                                <td id="freq-social">$0.00</td>
                            </tr>
                            <tr>
                                <td>Medicare Tax</td>
                                <td id="freq-medicare">$0.00</td>
                            </tr>
                            <tr>
                                <td>State Income Tax</td>
                                <td id="freq-state">$0.00</td>
                            </tr>
                            <tr>
                                <td>City Income Tax</td>
                                <td id="freq-city">$0.00</td>
                            </tr>
                            <tr>
                                <td>Pre-Tax Deductions</td>
                                <td id="freq-pretax">$0.00</td>
                            </tr>
                            <tr>
                                <td>Post-Tax Deductions</td>
                                <td id="freq-posttax">$0.00</td>
                            </tr>
                            <tr class="final-pay">
                                <td><strong>Final Pay Check</strong></td>
                                <td id="freq-final"><strong>$0.00</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const taxUnits = {
            federal: '%',
            socialSecurity: '%',
            medicare: '%',
            state: '%',
            city: '%',
            preTax: '%',
            postTax: '%',
        };

        const frequencyMultipliers = {
            daily: 365,
            weekly: 52,
            'bi-weekly': 26,
            'semi-monthly': 24,
            monthly: 12,
            quarterly: 4,
            'semi-annually': 2,
            annually: 1,
        };

        function toggleUnit(taxType) {
            // Find the correct input field and buttons
            let inputField, buttons;

            if (document.getElementById(`${taxType}Tax`)) {
                inputField = document.getElementById(`${taxType}Tax`);
                buttons = inputField.parentNode.querySelectorAll('.toggle-btn');
            } else if (document.getElementById(`${taxType}Deductions`)) {
                inputField = document.getElementById(`${taxType}Deductions`);
                buttons = inputField.parentNode.querySelectorAll('.toggle-btn');
            }

            if (!buttons || buttons.length < 2) return;

            // Store current input value before toggle
            const currentValue = inputField.value;

            // Toggle the unit
            buttons.forEach((btn) => btn.classList.remove('active'));
            taxUnits[taxType] = taxUnits[taxType] === '%' ? '$' : '%';

            if (taxUnits[taxType] === '%') {
                buttons[0].classList.add('active');
            } else {
                buttons[1].classList.add('active');
            }

            // Restore input value if it was cleared
            if (currentValue && !inputField.value) {
                inputField.value = currentValue;
            }

            // Only calculate if there's a valid value
            if (inputField.value && !isNaN(parseFloat(inputField.value))) {
                calculatePaycheck();
            }
        }

        function resetAll() {
            document.getElementById('jobIncome').value = '';
            document.getElementById('incomeType').value = 'annually';
            document.getElementById('payFrequency').value = 'monthly';
            document.getElementById('federalTax').value = '22';
            document.getElementById('socialSecurityTax').value = '6.2';
            document.getElementById('medicareTax').value = '1.45';
            document.getElementById('stateTax').value = '';
            document.getElementById('cityTax').value = '';
            document.getElementById('preTaxDeductions').value = '';
            document.getElementById('postTaxDeductions').value = '';

            Object.keys(taxUnits).forEach((key) => {
                taxUnits[key] = '%';
                const buttons = document.querySelectorAll(
                    `#${key}Tax`
                ).length
                    ? document
                        .querySelector(`#${key}Tax`)
                        .parentNode.querySelectorAll('.toggle-btn')
                    : document
                        .querySelector(`#${key}Deductions`)
                        .parentNode.querySelectorAll('.toggle-btn');
                buttons.forEach((btn) => btn.classList.remove('active'));
                buttons[0].classList.add('active');
            });

            calculatePaycheck();
        }

        function getTaxAmount(value, unit, base) {
            return unit === '%' ? (value / 100) * base : value;
        }

        function calculatePaycheck() {
            const jobIncome = parseFloat(document.getElementById('jobIncome').value) || 0;
            const incomeType = document.getElementById('incomeType').value;
            const payFrequency = document.getElementById('payFrequency').value;

            // Step 1: Calculate annual salary and gross pay per frequency
            const annualSalary = jobIncome * frequencyMultipliers[incomeType];
            const freqDivisor = frequencyMultipliers[payFrequency];
            const grossPay = annualSalary / freqDivisor;

            // Step 2: Calculate pre-tax deductions
            const preTaxInput = parseFloat(document.getElementById('preTaxDeductions').value) || 0;
            const preTax = getTaxAmount(preTaxInput, taxUnits.preTax, grossPay);

            // Step 3: Calculate taxable income (gross pay minus pre-tax deductions)
            const taxableIncome = grossPay - preTax;

            // Step 4: Calculate all taxes on taxable income
            const federalInput = parseFloat(document.getElementById('federalTax').value) || 0;
            const stateInput = parseFloat(document.getElementById('stateTax').value) || 0;
            const cityInput = parseFloat(document.getElementById('cityTax').value) || 0;
            const socialInput = parseFloat(document.getElementById('socialSecurityTax').value) || 0;
            const medicareInput = parseFloat(document.getElementById('medicareTax').value) || 0;

            // Calculate taxes based on taxable income (except for flat dollar amounts)
            const federal = getTaxAmount(federalInput, taxUnits.federal, taxableIncome);
            const state = getTaxAmount(stateInput, taxUnits.state, taxableIncome);
            const social = getTaxAmount(socialInput, taxUnits.socialSecurity, taxableIncome);
            const medicare = getTaxAmount(medicareInput, taxUnits.medicare, taxableIncome);

            // City tax can be flat dollar amount or percentage
            const city = getTaxAmount(cityInput, taxUnits.city, taxableIncome);

            // Step 5: Sum all taxes
            const totalTaxes = federal + state + city + social + medicare;

            // Step 6: Calculate post-tax deductions (based on gross pay)
            const postTaxInput = parseFloat(document.getElementById('postTaxDeductions').value) || 0;
            const postTax = getTaxAmount(postTaxInput, taxUnits.postTax, grossPay);

            // Step 7: Calculate final net pay
            const finalPay = grossPay - preTax - totalTaxes - postTax;

            // Display results for current frequency
            document.getElementById('monthly-gross').textContent = `$${grossPay.toFixed(2)}`;
            document.getElementById('monthly-pretax').textContent = `-$${preTax.toFixed(2)}`;
            document.getElementById('monthly-federal').textContent = `-$${federal.toFixed(2)}`;
            document.getElementById('monthly-state').textContent = `-$${state.toFixed(2)}`;
            document.getElementById('monthly-city').textContent = `-$${city.toFixed(2)}`;
            document.getElementById('monthly-social').textContent = `-$${social.toFixed(2)}`;
            document.getElementById('monthly-medicare').textContent = `-$${medicare.toFixed(2)}`;
            document.getElementById('monthly-posttax').textContent = `-$${postTax.toFixed(2)}`;
            document.getElementById('monthly-final').textContent = `$${finalPay.toFixed(2)}`;

            // Update table title
            const frequencyDisplayName = payFrequency.charAt(0).toUpperCase() + payFrequency.slice(1).replace('-', '-');
            document.querySelector('.table-title').textContent = `${frequencyDisplayName} Paycheck Based on Income of $${annualSalary.toLocaleString()}/year`;

            // Show frequency-specific results only if different from monthly
            if (payFrequency !== 'monthly') {
                document.getElementById('frequencyResults').style.display = 'block';
                document.getElementById('freq-gross').textContent = `$${grossPay.toFixed(2)}`;
                document.getElementById('freq-pretax').textContent = `-$${preTax.toFixed(2)}`;
                document.getElementById('freq-federal').textContent = `-$${federal.toFixed(2)}`;
                document.getElementById('freq-state').textContent = `-$${state.toFixed(2)}`;
                document.getElementById('freq-city').textContent = `-$${city.toFixed(2)}`;
                document.getElementById('freq-social').textContent = `-$${social.toFixed(2)}`;
                document.getElementById('freq-medicare').textContent = `-$${medicare.toFixed(2)}`;
                document.getElementById('freq-posttax').textContent = `-$${postTax.toFixed(2)}`;
                document.getElementById('freq-final').textContent = `$${finalPay.toFixed(2)}`;

                document.getElementById('frequencyTitle').textContent = `${frequencyDisplayName} Paycheck Based on Income of $${annualSalary.toLocaleString()}/year`;
            } else {
                document.getElementById('frequencyResults').style.display = 'none';
            }

            updateDownloadButton();
        }

        function updateDownloadButton() {
            const jobIncome = document.getElementById('jobIncome').value.trim();
            const payFrequency = document.getElementById('payFrequency').value.trim();
            const federalTax = document.getElementById('federalTax').value.trim();
            const downloadBtn = document.getElementById('downloadBtn');

            const isValid = jobIncome !== '' && !isNaN(jobIncome) && payFrequency !== '' && federalTax !== '' && !isNaN(federalTax);

            if (isValid) {
                downloadBtn.disabled = false;
                downloadBtn.title = '';
            } else {
                downloadBtn.disabled = true;
                downloadBtn.title = 'Please fill all required fields';
            }
        }

        function handleCalculate() {
            calculatePaycheck();
            setTimeout(() => {
                const resultSection = document.querySelector('#results');
                if (resultSection) {
                    resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 300);
        }

        function loadTaxRates() {
            document.getElementById('federalTax').value = '22';
            document.getElementById('socialSecurityTax').value = '6.2';
            document.getElementById('medicareTax').value = '1.45';
            calculatePaycheck();
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'a4',
            });

            const margin = 40;
            let y = margin;

            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.text('Official Paycheck Report', margin, y);
            y += 20;

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.text(`Generated on: ${new Date().toLocaleString()}`, margin, y);
            y += 18;

            doc.setDrawColor(180);
            doc.line(margin, y, 555, y);
            y += 14;

            const addSection = (title, data) => {
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(13);
                doc.text(title, margin, y);
                y += 14;

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(11);

                data.forEach(([label, amount]) => {
                    doc.text(label, margin, y);
                    doc.text(amount, 400, y, { align: 'right' });
                    y += 14;
                });

                y += 10;
            };

            const monthlyData = [
                ['Gross Pay', document.getElementById('monthly-gross').textContent],
                ['Pre-Tax Deductions', document.getElementById('monthly-pretax').textContent],
                ['Federal Income Tax', document.getElementById('monthly-federal').textContent],
                ['State Income Tax', document.getElementById('monthly-state').textContent],
                ['City Income Tax', document.getElementById('monthly-city').textContent],
                ['Social Security Tax', document.getElementById('monthly-social').textContent],
                ['Medicare Tax', document.getElementById('monthly-medicare').textContent],
                ['Post-Tax Deductions', document.getElementById('monthly-posttax').textContent],
                ['Final Paycheck', document.getElementById('monthly-final').textContent],
            ];
            addSection('Monthly Breakdown', monthlyData);

            const selectedFreq = document.getElementById('payFrequency').value;
            if (selectedFreq !== 'monthly') {
                const freqData = [
                    ['Gross Pay', document.getElementById('freq-gross')?.textContent || '$0.00'],
                    ['Pre-Tax Deductions', document.getElementById('freq-pretax')?.textContent || '$0.00'],
                    ['Federal Income Tax', document.getElementById('freq-federal')?.textContent || '$0.00'],
                    ['State Income Tax', document.getElementById('freq-state')?.textContent || '$0.00'],
                    ['City Income Tax', document.getElementById('freq-city')?.textContent || '$0.00'],
                    ['Social Security Tax', document.getElementById('freq-social')?.textContent || '$0.00'],
                    ['Medicare Tax', document.getElementById('freq-medicare')?.textContent || '$0.00'],
                    ['Post-Tax Deductions', document.getElementById('freq-posttax')?.textContent || '$0.00'],
                    ['Final Paycheck', document.getElementById('freq-final')?.textContent || '$0.00'],
                ];
                const title = `${selectedFreq.charAt(0).toUpperCase() + selectedFreq.slice(1)} Breakdown`;
                addSection(title, freqData);
            }

            doc.setFontSize(9);
            doc.setFont('helvetica', 'italic');
            doc.setTextColor(100);
            y += 4;
            doc.text(
                'This report is an automated estimate and should be verified with a tax professional.',
                margin,
                y
            );
            y += 10;
            doc.text('Powered by Paycheck Calculator © 2025', margin, y);

            doc.save('official-paycheck-report.pdf');
        }


        document.addEventListener('DOMContentLoaded', function () {
            const inputs = ['jobIncome', 'incomeType', 'payFrequency', 'federalTax', 'socialSecurityTax', 'medicareTax', 'stateTax', 'cityTax', 'preTaxDeductions', 'postTaxDeductions'];

            inputs.forEach((id) => {
                const element = document.getElementById(id);
                if (element) {
                    // Use debounced input for better performance
                    let timeout;
                    element.addEventListener('input', function () {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            calculatePaycheck();
                        }, 300); // 300ms delay
                    });

                    // Immediate calculation on change (when user leaves field)
                    element.addEventListener('change', function () {
                        clearTimeout(timeout);
                        calculatePaycheck();
                    });

                    // Prevent input clearing on focus
                    element.addEventListener('focus', function () {
                        // Store the value when focused
                        element.setAttribute('data-previous-value', element.value);
                    });

                    // Restore value if it gets cleared accidentally
                    element.addEventListener('blur', function () {
                        if (!element.value && element.getAttribute('data-previous-value')) {
                            // Only restore if the field is completely empty
                            const previousValue = element.getAttribute('data-previous-value');
                            if (previousValue && previousValue.trim() !== '') {
                                element.value = previousValue;
                            }
                        }
                        element.removeAttribute('data-previous-value');
                    });
                }
            });

            // Initialize
            loadTaxRates();
            calculatePaycheck();
        });
    </script>

</body>

</html>