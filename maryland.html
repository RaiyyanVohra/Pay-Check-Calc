<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indiana Paycheck Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            padding: 32px;
            color: white;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 32px;
        }

        .input-section {
            margin-bottom: 32px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .required {
            color: #dc2626;
            margin-left: 4px;
        }

        .tooltip {
            margin-left: 8px;
            cursor: help;
            color: #6b7280;
            position: relative;
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #e5e7eb;
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            max-width: 200px;
            white-space: normal;
            width: max-content;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            overflow: hidden;
        }

        input,
        select {
            flex: 1;
            padding: 10px 12px;
            border: none;
            font-size: 14px;
            background: transparent;
            outline: none;
        }

        input:focus,
        select:focus {
            outline: none;
        }

        .input-wrapper:focus-within {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .toggle-btn {
            padding: 8px 12px;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 12px;
            color: #6b7280;
            border-left: 1px solid #d1d5db;
            transition: all 0.2s;
            min-width: 35px;
        }

        .toggle-btn.active {
            background: #3b82f6;
            color: white;
        }

        .external-link {
            color: #3b82f6;
            text-decoration: underline;
            cursor: pointer;
            font-size: 12px;
            margin-top: 4px;
        }

        .buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin: 24px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn-reset {
            background: #9ca3af;
            color: white;
        }

        .btn-reset:hover {
            background: #6b7280;
        }

        .btn-calculate {
            background: #dc2626;
            color: white;
            font-size: 16px;
            padding: 12px 32px;
        }

        .btn-calculate:hover {
            background: #b91c1c;
        }

        .btn-download {
            background: #10b981;
            color: white;
        }

        .btn-download:hover:not(:disabled) {
            background: #059669;
        }

        .btn-download:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .output-section {
            margin-top: 32px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }

        .results-table-container {
            background: #3b82f6;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .results-header {
            background: #3b82f6;
            color: white;
            padding: 16px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .results-table th,
        .results-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        .results-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
        }

        .results-table td:last-child {
            text-align: right;
        }

        .results-table tr:hover {
            background: #f8fafc;
        }

        .final-pay {
            background: #ecfdf5 !important;
            font-weight: 600;
            color: #059669;
        }

        .negative-amount {
            color: #dc2626;
        }

        .positive-amount {
            color: #059669;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .refresh-icon {
            margin-left: 8px;
            cursor: pointer;
            color: #4f46e5;
        }

        .refresh-icon:hover {
            color: #3730a3;
        }

        @media (max-width: 768px) {
            .input-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .main-content {
                padding: 20px;
            }

            .header {
                padding: 24px 20px;
            }

            .header h1 {
                font-size: 1.6rem;
            }

            .buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {

            .results-table th,
            .results-table td {
                font-size: 13px;
                padding: 10px 12px;
            }

            .section-title {
                font-size: 1.2rem;
            }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Indiana Paycheck Calculator</h1>
            <p>Calculate your net pay with Indiana's 3.05% state tax rate</p>
        </div>

        <div class="main-content">
            <!-- Input Section -->
            <div class="input-section">
                <!-- First Row -->
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            Your job income <span class="required">*</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="jobIncome" placeholder="50000" required>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Pay Frequency <span class="required">*</span>
                            <span class="tooltip" data-tooltip="How often you receive your paycheck">?</span>
                        </label>
                        <div class="input-wrapper">
                            <select id="payFrequency" required>
                                <option value="annually">Annually</option>
                                <option value="monthly" selected>Monthly</option>
                                <option value="semi-monthly">Semi-monthly</option>
                                <option value="bi-weekly">Bi-weekly</option>
                                <option value="weekly">Weekly</option>
                                <option value="daily">Daily</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="semi-annually">Semi-annually</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Federal Income Tax <span class="required">*</span>
                            <span class="tooltip" data-tooltip="Mandatory tax by U.S. federal government">?</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="federalTax" value="22" step="0.01" required>
                            <button type="button" class="toggle-btn active" onclick="toggleUnit('federal')">%</button>
                            <button type="button" class="toggle-btn" onclick="toggleUnit('federal')">$</button>
                        </div>
                    </div>
                </div>

                <!-- Second Row -->
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            Social Security Tax
                            <span class="tooltip" data-tooltip="FICA contribution; 6.2% by employee">?</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="socialSecurityTax" value="6.2" step="0.01">
                            <button type="button" class="toggle-btn active"
                                onclick="toggleUnit('socialSecurity')">%</button>
                            <button type="button" class="toggle-btn" onclick="toggleUnit('socialSecurity')">$</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Medicare Tax
                            <span class="tooltip" data-tooltip="FICA contribution; 1.45% by employee">?</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="medicareTax" value="1.45" step="0.01">
                            <button type="button" class="toggle-btn active" onclick="toggleUnit('medicare')">%</button>
                            <button type="button" class="toggle-btn" onclick="toggleUnit('medicare')">$</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Indiana State Tax
                            <span class="tooltip" data-tooltip="Indiana flat tax rate of 3.05%">?</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="stateTax" value="3.05" step="0.01">
                            <button type="button" class="toggle-btn active" onclick="toggleUnit('state')">%</button>
                            <button type="button" class="toggle-btn" onclick="toggleUnit('state')">$</button>
                        </div>
                        <div class="external-link"
                            onclick="window.open('https://en.wikipedia.org/wiki/State_income_tax', '_blank')">
                            click here to check
                        </div>
                    </div>
                </div>

                <!-- Third Row -->
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">
                            City Income Tax
                            <span class="tooltip" data-tooltip="Some cities add local income tax">?</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="cityTax" placeholder="200" step="0.01">
                            <button type="button" class="toggle-btn active" onclick="toggleUnit('city')">%</button>
                            <button type="button" class="toggle-btn" onclick="toggleUnit('city')">$</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Pre-Tax Deductions
                            <span class="tooltip" data-tooltip="401(k), insurance, etc. Deducted before taxes">?</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="preTaxDeductions" placeholder="200" step="0.01">
                            <button type="button" class="toggle-btn active" onclick="toggleUnit('preTax')">%</button>
                            <button type="button" class="toggle-btn" onclick="toggleUnit('preTax')">$</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Post-Tax Deductions
                            <span class="tooltip"
                                data-tooltip="Union dues or loan payments. Deducted after taxes">?</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="postTaxDeductions" placeholder="200" step="0.01">
                            <button type="button" class="toggle-btn active" onclick="toggleUnit('postTax')">%</button>
                            <button type="button" class="toggle-btn" onclick="toggleUnit('postTax')">$</button>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="buttons">
                    <button class="btn btn-reset" onclick="resetAll()">Reset</button>
                    <button class="btn btn-calculate" onclick="handleCalculate()">Calculate</button>
                </div>
            </div>

            <!-- Output Section -->
            <div id="results" class="output-section">
                <h2 class="section-title">Paycheck Calculation Results</h2>

                <!-- Results Table -->
                <div class="results-table-container">
                    <div class="results-header" id="resultsHeader">
                        Monthly Paycheck Based on Income of $50,000.00/year
                    </div>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Amount ($)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Gross Pay</td>
                                <td id="monthly-gross" class="positive-amount">$4,166.67</td>
                            </tr>
                            <tr>
                                <td>Pre-Tax Deductions</td>
                                <td id="monthly-pretax" class="negative-amount">-$200.00</td>
                            </tr>
                            <tr>
                                <td>Federal Income Tax</td>
                                <td id="monthly-federal" class="negative-amount">-$872.67</td>
                            </tr>
                            <tr>
                                <td>Social Security Tax</td>
                                <td id="monthly-social" class="negative-amount">-$245.93</td>
                            </tr>
                            <tr>
                                <td>Medicare Tax</td>
                                <td id="monthly-medicare" class="negative-amount">-$57.52</td>
                            </tr>
                            <tr>
                                <td>Indiana State Tax (3.05%)</td>
                                <td id="monthly-state" class="negative-amount">-$120.33</td>
                            </tr>
                            <tr>
                                <td>City Income Tax</td>
                                <td id="monthly-city" class="negative-amount">-$200.00</td>
                            </tr>
                            <tr>
                                <td>Post-Tax Deductions</td>
                                <td id="monthly-posttax" class="negative-amount">-$200.00</td>
                            </tr>
                            <tr class="final-pay">
                                <td><strong>Final Net Pay</strong></td>
                                <td id="monthly-final"><strong>$2,192.22</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="buttons">
                    <button class="btn btn-download" id="downloadBtn" onclick="downloadPDF()">
                        Generate PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Keep the original income type hidden but use annually by default
        const jobIncomeType = 'annually';

        const taxUnits = {
            federal: '%',
            socialSecurity: '%',
            medicare: '%',
            state: '%',
            city: '%',
            preTax: '%',
            postTax: '%',
        };

        const frequencyMultipliers = {
            daily: 365,
            weekly: 52,
            'bi-weekly': 26,
            'semi-monthly': 24,
            monthly: 12,
            quarterly: 4,
            'semi-annually': 2,
            annually: 1,
        };

        function toggleUnit(taxType) {
            // Find the correct input field and buttons
            let inputField, buttons;

            if (document.getElementById(`${taxType}Tax`)) {
                inputField = document.getElementById(`${taxType}Tax`);
                buttons = inputField.parentNode.querySelectorAll('.toggle-btn');
            } else if (document.getElementById(`${taxType}Deductions`)) {
                inputField = document.getElementById(`${taxType}Deductions`);
                buttons = inputField.parentNode.querySelectorAll('.toggle-btn');
            }

            if (!buttons || buttons.length < 2) return;

            // Store current input value before toggle
            const currentValue = inputField.value;

            // Toggle the unit
            buttons.forEach((btn) => btn.classList.remove('active'));
            taxUnits[taxType] = taxUnits[taxType] === '%' ? '$' : '%';

            if (taxUnits[taxType] === '%') {
                buttons[0].classList.add('active');
            } else {
                buttons[1].classList.add('active');
            }

            // Restore input value if it was cleared
            if (currentValue && !inputField.value) {
                inputField.value = currentValue;
            }

            // Only calculate if there's a valid value
            if (inputField.value && !isNaN(parseFloat(inputField.value))) {
                calculatePaycheck();
            }
        }

        function resetAll() {
            document.getElementById('jobIncome').value = '';
            document.getElementById('payFrequency').value = 'monthly';
            document.getElementById('federalTax').value = '22';
            document.getElementById('socialSecurityTax').value = '6.2';
            document.getElementById('medicareTax').value = '1.45';
            document.getElementById('stateTax').value = '3.05';
            document.getElementById('cityTax').value = '';
            document.getElementById('preTaxDeductions').value = '';
            document.getElementById('postTaxDeductions').value = '';

            Object.keys(taxUnits).forEach((key) => {
                taxUnits[key] = '%';
                const buttons = document.querySelectorAll(
                    `#${key}Tax`
                ).length
                    ? document
                        .querySelector(`#${key}Tax`)
                        .parentNode.querySelectorAll('.toggle-btn')
                    : document
                        .querySelector(`#${key}Deductions`)
                        .parentNode.querySelectorAll('.toggle-btn');
                buttons.forEach((btn) => btn.classList.remove('active'));
                buttons[0].classList.add('active');
            });

            calculatePaycheck();
        }

        function getTaxAmount(value, unit, base) {
            return unit === '%' ? (value / 100) * base : value;
        }

        function calculatePaycheck() {
            const jobIncome = parseFloat(document.getElementById('jobIncome').value) || 0;
            const payFrequency = document.getElementById('payFrequency').value;

            // Step 1: Calculate annual salary and gross pay per frequency (assume input is annual)
            const annualSalary = jobIncome; // Always treat input as annual
            const freqDivisor = frequencyMultipliers[payFrequency];
            const grossPay = annualSalary / freqDivisor;

            // Step 2: Calculate pre-tax deductions
            const preTaxInput = parseFloat(document.getElementById('preTaxDeductions').value) || 0;
            const preTax = getTaxAmount(preTaxInput, taxUnits.preTax, grossPay);

            // Step 3: Calculate taxable income (gross pay minus pre-tax deductions)
            const taxableIncome = grossPay - preTax;

            // Step 4: Calculate all taxes on taxable income
            const federalInput = parseFloat(document.getElementById('federalTax').value) || 0;
            const stateInput = parseFloat(document.getElementById('stateTax').value) || 0;
            const cityInput = parseFloat(document.getElementById('cityTax').value) || 0;
            const socialInput = parseFloat(document.getElementById('socialSecurityTax').value) || 0;
            const medicareInput = parseFloat(document.getElementById('medicareTax').value) || 0;

            // Calculate taxes based on taxable income (except for flat dollar amounts)
            const federal = getTaxAmount(federalInput, taxUnits.federal, taxableIncome);
            const state = getTaxAmount(stateInput, taxUnits.state, taxableIncome);
            const social = getTaxAmount(socialInput, taxUnits.socialSecurity, taxableIncome);
            const medicare = getTaxAmount(medicareInput, taxUnits.medicare, taxableIncome);

            // City tax can be flat dollar amount or percentage
            const city = getTaxAmount(cityInput, taxUnits.city, taxableIncome);

            // Step 5: Sum all taxes
            const totalTaxes = federal + state + city + social + medicare;

            // Step 6: Calculate post-tax deductions (based on gross pay)
            const postTaxInput = parseFloat(document.getElementById('postTaxDeductions').value) || 0;
            const postTax = getTaxAmount(postTaxInput, taxUnits.postTax, grossPay);

            // Step 7: Calculate final net pay
            const finalPay = grossPay - preTax - totalTaxes - postTax;

            // Display results for current frequency
            document.getElementById('monthly-gross').textContent = `$${grossPay.toFixed(2)}`;
            document.getElementById('monthly-pretax').textContent = `-$${preTax.toFixed(2)}`;
            document.getElementById('monthly-federal').textContent = `-$${federal.toFixed(2)}`;
            document.getElementById('monthly-state').textContent = `-$${state.toFixed(2)}`;
            document.getElementById('monthly-city').textContent = `-$${city.toFixed(2)}`;
            document.getElementById('monthly-social').textContent = `-$${social.toFixed(2)}`;
            document.getElementById('monthly-medicare').textContent = `-$${medicare.toFixed(2)}`;
            document.getElementById('monthly-posttax').textContent = `-$${postTax.toFixed(2)}`;
            document.getElementById('monthly-final').textContent = `$${finalPay.toFixed(2)}`;

            // Update header title
            const frequencyDisplayName = payFrequency.charAt(0).toUpperCase() + payFrequency.slice(1).replace('-', '-');
            document.getElementById('resultsHeader').textContent = `${frequencyDisplayName} Paycheck Based on Income of $${annualSalary.toLocaleString()}/year`;

            updateDownloadButton();
        }

        function updateDownloadButton() {
            const jobIncome = document.getElementById('jobIncome').value.trim();
            const payFrequency = document.getElementById('payFrequency').value.trim();
            const federalTax = document.getElementById('federalTax').value.trim();
            const downloadBtn = document.getElementById('downloadBtn');

            const isValid = jobIncome !== '' && !isNaN(jobIncome) && payFrequency !== '' && federalTax !== '' && !isNaN(federalTax);

            if (isValid) {
                downloadBtn.disabled = false;
                downloadBtn.title = '';
            } else {
                downloadBtn.disabled = true;
                downloadBtn.title = 'Please fill all required fields';
            }
        }

        function handleCalculate() {
            calculatePaycheck();
            setTimeout(() => {
                const resultSection = document.querySelector('#results');
                if (resultSection) {
                    resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 300);
        }

        function loadTaxRates() {
            document.getElementById('federalTax').value = '22';
            document.getElementById('socialSecurityTax').value = '6.2';
            document.getElementById('medicareTax').value = '1.45';
            document.getElementById('stateTax').value = '3.05';
            calculatePaycheck();
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'a4',
            });

            const margin = 40;
            let y = margin;

            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.text('Official Paycheck Report', margin, y);
            y += 20;

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            doc.text(`Generated on: ${new Date().toLocaleString()}`, margin, y);
            y += 18;

            doc.setDrawColor(180);
            doc.line(margin, y, 555, y);
            y += 14;

            const addSection = (title, data) => {
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(13);
                doc.text(title, margin, y);
                y += 14;

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(11);

                data.forEach(([label, amount]) => {
                    doc.text(label, margin, y);
                    doc.text(amount, 400, y, { align: 'right' });
                    y += 14;
                });

                y += 10;
            };

            const monthlyData = [
                ['Gross Pay', document.getElementById('monthly-gross').textContent],
                ['Pre-Tax Deductions', document.getElementById('monthly-pretax').textContent],
                ['Federal Income Tax', document.getElementById('monthly-federal').textContent],
                ['State Income Tax', document.getElementById('monthly-state').textContent],
                ['City Income Tax', document.getElementById('monthly-city').textContent],
                ['Social Security Tax', document.getElementById('monthly-social').textContent],
                ['Medicare Tax', document.getElementById('monthly-medicare').textContent],
                ['Post-Tax Deductions', document.getElementById('monthly-posttax').textContent],
                ['Final Paycheck', document.getElementById('monthly-final').textContent],
            ];

            const selectedFreq = document.getElementById('payFrequency').value;
            const title = `${selectedFreq.charAt(0).toUpperCase() + selectedFreq.slice(1)} Breakdown`;
            addSection(title, monthlyData);

            doc.setFontSize(9);
            doc.setFont('helvetica', 'italic');
            doc.setTextColor(100);
            y += 4;
            doc.text(
                'This report is an automated estimate and should be verified with a tax professional.',
                margin,
                y
            );
            y += 10;
            doc.text('Powered by Indiana Paycheck Calculator © 2025', margin, y);

            doc.save('indiana-paycheck-report.pdf');
        }

        document.addEventListener('DOMContentLoaded', function () {
            const inputs = ['jobIncome', 'incomeType', 'payFrequency', 'federalTax', 'socialSecurityTax', 'medicareTax', 'stateTax', 'cityTax', 'preTaxDeductions', 'postTaxDeductions'];

            inputs.forEach((id) => {
                const element = document.getElementById(id);
                if (element) {
                    // Use debounced input for better performance
                    let timeout;
                    element.addEventListener('input', function () {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            calculatePaycheck();
                        }, 300); // 300ms delay
                    });

                    // Immediate calculation on change (when user leaves field)
                    element.addEventListener('change', function () {
                        clearTimeout(timeout);
                        calculatePaycheck();
                    });

                    // Prevent input clearing on focus
                    element.addEventListener('focus', function () {
                        // Store the value when focused
                        element.setAttribute('data-previous-value', element.value);
                    });

                    // Restore value if it gets cleared accidentally
                    element.addEventListener('blur', function () {
                        if (!element.value && element.getAttribute('data-previous-value')) {
                            // Only restore if the field is completely empty
                            const previousValue = element.getAttribute('data-previous-value');
                            if (previousValue && previousValue.trim() !== '') {
                                element.value = previousValue;
                            }
                        }
                        element.removeAttribute('data-previous-value');
                    });
                }
            });

            // Initialize
            loadTaxRates();
            calculatePaycheck();
        });
    </script>

</body>

</html>